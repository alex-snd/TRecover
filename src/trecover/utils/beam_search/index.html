
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="A Python library to train Transformer neural network for keyless reading task." name="description"/>
<meta content="Alexander Shulga" name="author"/>
<link href="../../../../static/images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.3.0, mkdocs-material-8.3.3" name="generator"/>
<title>Beam Search - TRecover</title>
<link href="../../../../assets/stylesheets/main.4a0965b7.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Georgia:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Georgia";--md-code-font:"Roboto Mono"}</style>
<link href="../../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../../../static/css/custom.css" rel="stylesheet"/>
<link href="../../../../static/css/termynal.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1NKZB5WK07"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-1NKZB5WK07",{page_path:e.pathname})})})</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1NKZB5WK07"></script>
<link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#src.trecover.utils.beam_search.get_steps_params">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="TRecover" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="TRecover">
<img alt="logo" src="../../../../static/images/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            TRecover
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Beam Search
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/alex-snd/TRecover" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    alex-snd/TRecover
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../../app/cli/">
        Reference
      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="TRecover" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="TRecover">
<img alt="logo" src="../../../../static/images/logo.png"/>
</a>
    TRecover
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/alex-snd/TRecover" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    alex-snd/TRecover
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          Reference
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2_1" id="__nav_2_1" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../app/cli/">CLI</a>
<label for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="CLI" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
          CLI
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/cli/download/">
        Download
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/cli/collab/">
        Collab
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/cli/mlflow/">
        Mlflow
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/cli/dashboard/">
        Dashboard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/cli/api/">
        API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/cli/worker/">
        Worker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/cli/broker/">
        Broker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/cli/backend/">
        Backend
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../app/api/">API</a>
<label for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="API" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
          API
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/api/schemas/">
        Schemas
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../app/api/backend/tasks/">
        Celery Tasks
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3">
          Utils
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Utils" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
          Utils
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Beam Search
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Beam Search
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.get_steps_params">
    get_steps_params()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.beam_step">
    beam_step()
  </a>
<nav aria-label="beam_step()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.beam_step--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.celery_task_loop">
    celery_task_loop()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.cli_interactive_loop">
    cli_interactive_loop()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.dashboard_loop">
    dashboard_loop()
  </a>
<nav aria-label="dashboard_loop()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.dashboard_loop--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.standard_loop">
    standard_loop()
  </a>
<nav aria-label="standard_loop()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.standard_loop--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.beam_search">
    beam_search()
  </a>
<nav aria-label="beam_search()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.beam_search--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.async_beam_step">
    async_beam_step()
  </a>
<nav aria-label="async_beam_step()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.async_beam_step--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.api_interactive_loop">
    api_interactive_loop()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.standard_async_loop">
    standard_async_loop()
  </a>
<nav aria-label="standard_async_loop()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.standard_async_loop--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.async_beam_search">
    async_beam_search()
  </a>
<nav aria-label="async_beam_search()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.async_beam_search--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cli/">
        CLI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docker/">
        Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../inference/">
        Inference
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../model/">
        Model
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../train/">
        Train
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../transform/">
        Transform
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../visualization/">
        Visualization
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" hidden="">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.get_steps_params">
    get_steps_params()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.beam_step">
    beam_step()
  </a>
<nav aria-label="beam_step()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.beam_step--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.celery_task_loop">
    celery_task_loop()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.cli_interactive_loop">
    cli_interactive_loop()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.dashboard_loop">
    dashboard_loop()
  </a>
<nav aria-label="dashboard_loop()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.dashboard_loop--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.standard_loop">
    standard_loop()
  </a>
<nav aria-label="standard_loop()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.standard_loop--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.beam_search">
    beam_search()
  </a>
<nav aria-label="beam_search()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.beam_search--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.async_beam_step">
    async_beam_step()
  </a>
<nav aria-label="async_beam_step()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.async_beam_step--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.api_interactive_loop">
    api_interactive_loop()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.standard_async_loop">
    standard_async_loop()
  </a>
<nav aria-label="standard_async_loop()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.standard_async_loop--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.async_beam_search">
    async_beam_search()
  </a>
<nav aria-label="async_beam_search()" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.trecover.utils.beam_search.async_beam_search--notes">
    Notes
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>Beam Search</h1>
<div class="doc doc-object doc-module">
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.get_steps_params">
get_steps_params


</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">get_steps_params</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Get probability masks and beam widths required for each step of beam search algorithm.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, TOKEN_SIZE]</code>
</td>
<td><p>Keyless reading columns that are passed to the TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>steps_mask</code></td> <td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, TOKEN_SIZE]</code>
</td>
<td><p>Probability masks that consists of zeros in the places that correspond to the letters allowed
for selection in the column (src[i]) and values equal to minus infinity in all others.</p></td>
</tr>
<tr>
<td><code>steps_width</code></td> <td>
<code><span title="typing.List">List</span>[int]</code>
</td>
<td><p>The beam width for each step of the algorithm.</p></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">def</span> <span class="nf">get_steps_params</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Get probability masks and beam widths required for each step of beam search algorithm.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    src : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        Keyless reading columns that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    -------</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    steps_mask : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Probability masks that consists of zeros in the places that correspond to the letters allowed</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        for selection in the column (src[i]) and values equal to minus infinity in all others.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    steps_width : List[int]</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        The beam width for each step of the algorithm.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    """</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">'-inf'</span><span class="p">))</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="n">src</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="n">src</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">int</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.beam_step">
beam_step


</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">beam_step</span><span class="p">(</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="n">candidates</span><span class="p">,</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">step_mask</span><span class="p">,</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="n">step_width</span><span class="p">,</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="n">encoded_src</span><span class="p">,</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="n">model</span><span class="p">,</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="n">beam_width</span><span class="p">,</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="n">device</span><span class="p">,</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Implementation of the beam search algorithm step.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>candidates</code></td>
<td>
<code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="torch.Tensor">Tensor</span>[1, STEP_NUMBER, TOKEN_SIZE], float]]</code>
</td>
<td><p>List of candidates from the previous step.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>step_mask</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[TOKEN_SIZE]</code>
</td>
<td><p>Column's mask that consists of zeros in the places that correspond to the letters allowed
for selection in the column and values equal to minus infinity in all others.
Required so that only the letters in the column are selected as a candidates.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>step_width</code></td>
<td>
<code>int</code>
</td>
<td><p>Number of candidates that are contained in the step column.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>encoded_src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, 1, D_MODEL]</code>
</td>
<td><p>Columns for keyless reading that were encoded by TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>model</code></td>
<td>
<code><span title="trecover.model.TRecover">TRecover</span></code>
</td>
<td><p>Trained model for keyless reading.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>beam_width</code></td>
<td>
<code>int</code>
</td>
<td><p>Number of candidates that can be selected at the current step.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>device</code></td>
<td>
<code>torch.<span title="torch.device">device</span></code>
</td>
<td><p>Device on which to allocate the candidate chains.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>step_candidates</code></td> <td>
<code>List[Tuple[Tensor[1, STEP_NUMBER </code>
</td>
<td><p>List of candidates of size "beam_width" for the current step
sorted in descending order of their probabilities.</p></td>
</tr>
</tbody>
</table>
<h4 id="src.trecover.utils.beam_search.beam_step--notes">Notes</h4>
<p>For each chain candidate from the previous step:
*       Probability distribution is calculated using trained TRecover model to
        select the next symbol from the current column,taking into account the "step_mask".
*       The most probable symbols are selected from the calculated probability distribution,
        the number of which is set by the "step_width" and "beam_width" parameters.
*       For each selected symbol, a new candidate chain with updated probability
        is constructed and placed in the "step_candidates" list.</p>
<p>All candidates are sorted in descending order of probabilities and the most probable ones
are selected from them, the number of which is set by the "beam_width" parameter.</p>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="k">def</span> <span class="nf">beam_step</span><span class="p">(</span><span class="n">candidates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>              <span class="n">step_mask</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>              <span class="n">step_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>              <span class="n">encoded_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>              <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>              <span class="n">beam_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>              <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>              <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    Implementation of the beam search algorithm step.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    candidates : List[Tuple[Tensor[1, STEP_NUMBER, TOKEN_SIZE], float]]</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        List of candidates from the previous step.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    step_mask : Tensor[TOKEN_SIZE]</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Column's mask that consists of zeros in the places that correspond to the letters allowed</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        for selection in the column and values equal to minus infinity in all others.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        Required so that only the letters in the column are selected as a candidates.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    step_width : int</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        Number of candidates that are contained in the step column.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    encoded_src : Tensor[SEQUENCE_LEN, 1, D_MODEL]</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        Columns for keyless reading that were encoded by TRecover encoder.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    model : TRecover</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Trained model for keyless reading.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    beam_width : int</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        Number of candidates that can be selected at the current step.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    device : torch.device</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    -------</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    step_candidates : List[Tuple[Tensor[1, STEP_NUMBER + 1, TOKEN_SIZE], float]]</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        List of candidates of size "beam_width" for the current step</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        sorted in descending order of their probabilities.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    -----</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    For each chain candidate from the previous step:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    *       Probability distribution is calculated using trained TRecover model to</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            select the next symbol from the current column,taking into account the "step_mask".</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    *       The most probable symbols are selected from the calculated probability distribution,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            the number of which is set by the "step_width" and "beam_width" parameters.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    *       For each selected symbol, a new candidate chain with updated probability</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            is constructed and placed in the "step_candidates" list.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    All candidates are sorted in descending order of probabilities and the most probable ones</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    are selected from them, the number of which is set by the "beam_width" parameter.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    """</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">step_candidates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">tgt_attn_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tgt_pad_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">src_pad_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">probabilities</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">step_mask</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">values</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">probabilities</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">beam_width</span><span class="p">,</span> <span class="n">step_width</span><span class="p">))</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">for</span> <span class="n">prob</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">new_token</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">token_size</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="n">new_token</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="n">step_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">chain</span><span class="p">,</span> <span class="n">new_token</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">score</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">)))</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">step_candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">candidate</span><span class="p">:</span> <span class="o">-</span><span class="n">candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">])[:</span><span class="n">beam_width</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.celery_task_loop">
celery_task_loop


</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">celery_task_loop</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Get a beam search algorithm loop function, which is implemented for the Celery task.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>task</code></td>
<td>
<code>celery.<span title="celery.Task">Task</span></code>
</td>
<td><p>Celery task base class.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>inner_loop</code></td> <td>
<code><span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>, <span title="torch.Tensor">Tensor</span>, <span title="trecover.model.TRecover">TRecover</span>, int, torch.<span title="torch.device">device</span>], <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="torch.Tensor">Tensor</span>, float]]]</code>
</td>
<td><p>Beam search algorithm loop function for the Celery task.</p></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="k">def</span> <span class="nf">celery_task_loop</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">Task</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">TRecover</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    Get a beam search algorithm loop function, which is implemented for the Celery task.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    task : celery.Task</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Celery task base class.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    -------</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    inner_loop : Callable[[Tensor, Tensor, TRecover, int, torch.device], List[Tuple[Tensor, float]]]</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        Beam search algorithm loop function for the Celery task.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    """</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">def</span> <span class="nf">inner_loop</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                   <span class="n">encoded_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                   <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                   <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                   <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="w">        </span><span class="sd">"""</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Beam search algorithm loop implementation for the Celery task.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        src : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">            Keyless reading columns that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        encoded_src : Tensor[SEQUENCE_LEN, 1, D_MODEL]</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">            Keyless reading columns that were encoded by TRecover encoder.</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        model : TRecover</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">            Trained model for keyless reading.</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        width : int</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">            Number of candidates that can be selected at each step.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        device : torch.device</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">            Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        -------</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        candidates : List[Tuple[Tensor[1, SEQUENCE_LEN + 1, TOKEN_SIZE], float]]</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">            List of chains sorted in descending order of probabilities.</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">            The number of candidates is set by the "width" parameter.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        -----</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        Probability masks and beam widths values required for each step of the</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        beam search algorithm are calculated by the "get_steps_params" function using</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        keyless reading columns ("src") that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        An empty chain (zero token of shape [1, 1, TOKEN_SIZE]) with zero probability</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        is used as the first candidate for the algorithm.</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        The progress of the Celery task is updated at each step of the algorithm.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        """</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">step_masks</span><span class="p">,</span> <span class="n">step_widths</span> <span class="o">=</span> <span class="n">get_steps_params</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">token_size</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">encoded_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="n">candidates</span> <span class="o">=</span> <span class="n">beam_step</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">step_masks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">task</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">'progress'</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">},</span> <span class="n">state</span><span class="o">=</span><span class="s1">'PREDICT'</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="k">return</span> <span class="n">candidates</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">return</span> <span class="n">inner_loop</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.cli_interactive_loop">
cli_interactive_loop


</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">cli_interactive_loop</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'Processing'</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Get a beam search algorithm loop function, which is implemented for the cli interface.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>label</code></td>
<td>
<code>str</code>
</td>
<td><p>Label for the cli progress bar.</p></td>
<td>
<code>'Processing'</code>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>inner_loop</code></td> <td>
<code><span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>, <span title="torch.Tensor">Tensor</span>, <span title="trecover.model.TRecover">TRecover</span>, int, torch.<span title="torch.device">device</span>], <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="torch.Tensor">Tensor</span>, float]]]</code>
</td>
<td><p>Beam search algorithm loop function for the cli interface.</p></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="k">def</span> <span class="nf">cli_interactive_loop</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'Processing'</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">TRecover</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    Get a beam search algorithm loop function, which is implemented for the cli interface.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    label : str</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        Label for the cli progress bar.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    -------</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    inner_loop : Callable[[Tensor, Tensor, TRecover, int, torch.device], List[Tuple[Tensor, float]]]</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        Beam search algorithm loop function for the cli interface.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    """</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">def</span> <span class="nf">inner_loop</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                   <span class="n">encoded_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                   <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                   <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                   <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="w">        </span><span class="sd">"""</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        Beam search algorithm loop implementation for the cli interface.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        src : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">            Keyless reading columns that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        encoded_src : Tensor[SEQUENCE_LEN, 1, D_MODEL]</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">            Keyless reading columns that were encoded by TRecover encoder.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        model : TRecover</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">            Trained model for keyless reading.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        width : int</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">            Number of candidates that can be selected at each step.</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        device : torch.device</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">            Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        -------</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        candidates : List[Tuple[Tensor[1, SEQUENCE_LEN + 1, TOKEN_SIZE], float]]</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">            List of chains sorted in descending order of probabilities.</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">            The number of candidates is set by the "width" parameter.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        -----</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        Probability masks and beam widths values required for each step of the</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        beam search algorithm are calculated by the "get_steps_params" function using</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        keyless reading columns ("src") that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        An empty chain (zero token of shape [1, 1, TOKEN_SIZE]) with zero probability</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        is used as the first candidate for the algorithm.</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        At each step of the algorithm, the progress bar of the task</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        is updated and displayed in the console.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        """</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="n">step_masks</span><span class="p">,</span> <span class="n">step_widths</span> <span class="o">=</span> <span class="n">get_steps_params</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">token_size</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="k">with</span> <span class="n">Progress</span><span class="p">(</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                <span class="n">TextColumn</span><span class="p">(</span><span class="s1">'</span><span class="si">{task.description}</span><span class="s1">'</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">'bright_blue'</span><span class="p">),</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="n">BarColumn</span><span class="p">(</span><span class="n">complete_style</span><span class="o">=</span><span class="s1">'bright_blue'</span><span class="p">),</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="n">TextColumn</span><span class="p">(</span><span class="s1">'</span><span class="si">{task.percentage:&gt;3.0f}</span><span class="s1">%'</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">'bright_blue'</span><span class="p">),</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="n">TextColumn</span><span class="p">(</span><span class="s1">'Remaining'</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">'bright_blue'</span><span class="p">),</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                <span class="n">TimeRemainingColumn</span><span class="p">(),</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="n">TextColumn</span><span class="p">(</span><span class="s1">'Elapsed'</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">'bright_blue'</span><span class="p">),</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                <span class="n">TimeElapsedColumn</span><span class="p">(),</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="n">transient</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="n">console</span><span class="o">=</span><span class="n">log</span><span class="o">.</span><span class="n">project_console</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">beam_progress</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">encoded_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">encoded_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="n">candidates</span> <span class="o">=</span> <span class="n">beam_step</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">step_masks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">beam_progress</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">return</span> <span class="n">candidates</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="k">return</span> <span class="n">inner_loop</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.dashboard_loop">
dashboard_loop


</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">dashboard_loop</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Beam search algorithm loop implementation for the dashboard interface.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, TOKEN_SIZE]</code>
</td>
<td><p>Keyless reading columns that are passed to the TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>encoded_src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, 1, D_MODEL]</code>
</td>
<td><p>Keyless reading columns that were encoded by TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>model</code></td>
<td>
<code><span title="trecover.model.TRecover">TRecover</span></code>
</td>
<td><p>Trained model for keyless reading.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>width</code></td>
<td>
<code>int</code>
</td>
<td><p>Number of candidates that can be selected at each step.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>device</code></td>
<td>
<code>torch.<span title="torch.device">device</span></code>
</td>
<td><p>Device on which to allocate the candidate chains.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>candidates</code></td> <td>
<code>List[Tuple[Tensor[1, SEQUENCE_LEN </code>
</td>
<td><p>List of chains sorted in descending order of probabilities.
The number of candidates is set by the "width" parameter.</p></td>
</tr>
</tbody>
</table>
<h4 id="src.trecover.utils.beam_search.dashboard_loop--notes">Notes</h4>
<p>Probability masks and beam widths values required for each step of the
beam search algorithm are calculated by the "get_steps_params" function using
keyless reading columns ("src") that are passed to the TRecover encoder.</p>
<p>An empty chain (zero token of shape [1, 1, TOKEN_SIZE]) with zero probability
is used as the first candidate for the algorithm.</p>
<p>At each step of the algorithm, the progress bar is updated and displayed on the dashboard.</p>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="k">def</span> <span class="nf">dashboard_loop</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                   <span class="n">encoded_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                   <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                   <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                   <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    Beam search algorithm loop implementation for the dashboard interface.</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    src : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        Keyless reading columns that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    encoded_src : Tensor[SEQUENCE_LEN, 1, D_MODEL]</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        Keyless reading columns that were encoded by TRecover encoder.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    model : TRecover</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        Trained model for keyless reading.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    width : int</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        Number of candidates that can be selected at each step.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    device : torch.device</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    -------</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    candidates : List[Tuple[Tensor[1, SEQUENCE_LEN + 1, TOKEN_SIZE], float]]</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        List of chains sorted in descending order of probabilities.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        The number of candidates is set by the "width" parameter.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    -----</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    Probability masks and beam widths values required for each step of the</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    beam search algorithm are calculated by the "get_steps_params" function using</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">    keyless reading columns ("src") that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    An empty chain (zero token of shape [1, 1, TOKEN_SIZE]) with zero probability</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    is used as the first candidate for the algorithm.</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    At each step of the algorithm, the progress bar is updated and displayed on the dashboard.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    """</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="nn">st</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">step_masks</span><span class="p">,</span> <span class="n">step_widths</span> <span class="o">=</span> <span class="n">get_steps_params</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">token_size</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="n">progress</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">encoded_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">candidates</span> <span class="o">=</span> <span class="n">beam_step</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">step_masks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">progress</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">encoded_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.standard_loop">
standard_loop


</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">standard_loop</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Base implementation of the beam search algorithm loop.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, TOKEN_SIZE]</code>
</td>
<td><p>Keyless reading columns that are passed to the TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>encoded_src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, 1, D_MODEL]</code>
</td>
<td><p>Keyless reading columns that were encoded by TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>model</code></td>
<td>
<code><span title="trecover.model.TRecover">TRecover</span></code>
</td>
<td><p>Trained model for keyless reading.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>width</code></td>
<td>
<code>int</code>
</td>
<td><p>Number of candidates that can be selected at each step.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>device</code></td>
<td>
<code>torch.<span title="torch.device">device</span></code>
</td>
<td><p>Device on which to allocate the candidate chains.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>candidates</code></td> <td>
<code>List[Tuple[Tensor[1, SEQUENCE_LEN </code>
</td>
<td><p>List of chains sorted in descending order of probabilities.
The number of candidates is set by the "width" parameter.</p></td>
</tr>
</tbody>
</table>
<h4 id="src.trecover.utils.beam_search.standard_loop--notes">Notes</h4>
<p>Probability masks and beam widths values required for each step of the
beam search algorithm are calculated by the "get_steps_params" function using
keyless reading columns ("src") that are passed to the TRecover encoder.</p>
<p>An empty chain (zero token of shape [1, 1, TOKEN_SIZE]) with zero probability
is used as the first candidate for the algorithm.</p>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="k">def</span> <span class="nf">standard_loop</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>                  <span class="n">encoded_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>                  <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                  <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                  <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    Base implementation of the beam search algorithm loop.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    src : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        Keyless reading columns that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">    encoded_src : Tensor[SEQUENCE_LEN, 1, D_MODEL]</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        Keyless reading columns that were encoded by TRecover encoder.</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">    model : TRecover</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        Trained model for keyless reading.</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">    width : int</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        Number of candidates that can be selected at each step.</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    device : torch.device</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    -------</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    candidates : List[Tuple[Tensor[1, SEQUENCE_LEN + 1, TOKEN_SIZE], float]]</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        List of chains sorted in descending order of probabilities.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        The number of candidates is set by the "width" parameter.</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">    -----</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    Probability masks and beam widths values required for each step of the</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">    beam search algorithm are calculated by the "get_steps_params" function using</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">    keyless reading columns ("src") that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    An empty chain (zero token of shape [1, 1, TOKEN_SIZE]) with zero probability</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">    is used as the first candidate for the algorithm.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    """</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="n">step_masks</span><span class="p">,</span> <span class="n">step_widths</span> <span class="o">=</span> <span class="n">get_steps_params</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">token_size</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">encoded_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">candidates</span> <span class="o">=</span> <span class="n">beam_step</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">step_masks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.beam_search">
beam_search


</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">beam_search</span><span class="p">(</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="n">src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">beam_loop</span><span class="o">=</span><span class="n">standard_loop</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Beam search algorithm implementation.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, TOKEN_SIZE]</code>
</td>
<td><p>Keyless reading columns that are passed to the TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>model</code></td>
<td>
<code><span title="trecover.model.TRecover">TRecover</span></code>
</td>
<td><p>Trained model for keyless reading.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>width</code></td>
<td>
<code>int</code>
</td>
<td><p>Number of candidates that can be selected at each step.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>device</code></td>
<td>
<code>torch.<span title="torch.device">device</span></code>
</td>
<td><p>Device on which to allocate the candidate chains.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>beam_loop</code></td>
<td>
<code>Callable[[Tensor, Tensor, TRecover, int, torch.device],</code>
</td>
<td><p>List[Tuple[Tensor, float]]], default=standard_loop
Beam search algorithm loop function.</p></td>
<td>
<code>standard_loop</code>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>candidates</code></td> <td>
<code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN], float]]</code>
</td>
<td><p>List of chains sorted in descending order of probabilities.
The number of candidates is set by the "width" parameter.</p></td>
</tr>
</tbody>
</table>
<h4 id="src.trecover.utils.beam_search.beam_search--notes">Notes</h4>
<p>Initially, the keyless reading columns ("src") are encoded using TRecover encoder,
then the encoded columns ("encoded_src") are used at each step of the algorithm.</p>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="k">def</span> <span class="nf">beam_search</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                <span class="n">beam_loop</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">TRecover</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">],</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                                    <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">standard_loop</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">    Beam search algorithm implementation.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    src : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">        Keyless reading columns that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    model : TRecover</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">        Trained model for keyless reading.</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    width : int</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">        Number of candidates that can be selected at each step.</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    device : torch.device</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    beam_loop : Callable[[Tensor, Tensor, TRecover, int, torch.device],</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">                        List[Tuple[Tensor, float]]], default=standard_loop</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        Beam search algorithm loop function.</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">    -------</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">    candidates : List[Tuple[Tensor[SEQUENCE_LEN], float]]</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        List of chains sorted in descending order of probabilities.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        The number of candidates is set by the "width" parameter.</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    -----</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    Initially, the keyless reading columns ("src") are encoded using TRecover encoder,</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">    then the encoded columns ("encoded_src") are used at each step of the algorithm.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">    """</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="n">encoded_src</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">src_pad_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="n">candidates</span> <span class="o">=</span> <span class="n">beam_loop</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">score</span><span class="p">)</span>  <span class="c1"># first token is empty_token</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">candidates</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.async_beam_step">
async_beam_step

  <span class="doc doc-properties">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">async_beam_step</span><span class="p">(</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="n">candidates</span><span class="p">,</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">step_mask</span><span class="p">,</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="n">step_width</span><span class="p">,</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="n">encoded_src</span><span class="p">,</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="n">model</span><span class="p">,</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="n">beam_width</span><span class="p">,</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="n">device</span><span class="p">,</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Asynchronous implementation of the beam search algorithm step.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>candidates</code></td>
<td>
<code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="torch.Tensor">Tensor</span>[1, STEP_NUMBER, TOKEN_SIZE], float]]</code>
</td>
<td><p>List of candidates from the previous step.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>step_mask</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[TOKEN_SIZE]</code>
</td>
<td><p>Column's mask that consists of zeros in the places that correspond to the letters allowed
for selection in the column and values equal to minus infinity in all others.
Required so that only the letters in the column are selected as a candidates.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>step_width</code></td>
<td>
<code>int</code>
</td>
<td><p>Number of candidates that are contained in the step column.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>encoded_src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, 1, D_MODEL]</code>
</td>
<td><p>Columns for keyless reading that were encoded by TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>model</code></td>
<td>
<code><span title="trecover.model.TRecover">TRecover</span></code>
</td>
<td><p>Trained model for keyless reading.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>beam_width</code></td>
<td>
<code>int</code>
</td>
<td><p>Number of candidates that can be selected at the current step.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>device</code></td>
<td>
<code>torch.<span title="torch.device">device</span></code>
</td>
<td><p>Device on which to allocate the candidate chains.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>step_candidates</code></td> <td>
<code>List[Tuple[Tensor[1, STEP_NUMBER </code>
</td>
<td><p>List of candidates of size "beam_width" for the current step
sorted in descending order of their probabilities.</p></td>
</tr>
</tbody>
</table>
<h4 id="src.trecover.utils.beam_search.async_beam_step--notes">Notes</h4>
<p>For each chain candidate from the previous step:
*       Probability distribution is calculated using trained TRecover model to
        select the next symbol from the current column,taking into account the "step_mask".
*       The most probable symbols are selected from the calculated probability distribution,
        the number of which is set by the "step_width" and "beam_width" parameters.
*       For each selected symbol, a new candidate chain with updated probability
        is constructed and placed in the "step_candidates" list.</p>
<p>All candidates are sorted in descending order of probabilities and the most probable ones
are selected from them, the number of which is set by the "beam_width" parameter.</p>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">async_beam_step</span><span class="p">(</span><span class="n">candidates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                          <span class="n">step_mask</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                          <span class="n">step_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                          <span class="n">encoded_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                          <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                          <span class="n">beam_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                          <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                          <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    Asynchronous implementation of the beam search algorithm step.</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">    candidates : List[Tuple[Tensor[1, STEP_NUMBER, TOKEN_SIZE], float]]</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">        List of candidates from the previous step.</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">    step_mask : Tensor[TOKEN_SIZE]</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        Column's mask that consists of zeros in the places that correspond to the letters allowed</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">        for selection in the column and values equal to minus infinity in all others.</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">        Required so that only the letters in the column are selected as a candidates.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">    step_width : int</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        Number of candidates that are contained in the step column.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    encoded_src : Tensor[SEQUENCE_LEN, 1, D_MODEL]</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">        Columns for keyless reading that were encoded by TRecover encoder.</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    model : TRecover</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        Trained model for keyless reading.</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    beam_width : int</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        Number of candidates that can be selected at the current step.</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    device : torch.device</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    -------</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    step_candidates : List[Tuple[Tensor[1, STEP_NUMBER + 1, TOKEN_SIZE], float]]</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">        List of candidates of size "beam_width" for the current step</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">        sorted in descending order of their probabilities.</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">    -----</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">    For each chain candidate from the previous step:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">    *       Probability distribution is calculated using trained TRecover model to</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">            select the next symbol from the current column,taking into account the "step_mask".</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    *       The most probable symbols are selected from the calculated probability distribution,</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">            the number of which is set by the "step_width" and "beam_width" parameters.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    *       For each selected symbol, a new candidate chain with updated probability</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">            is constructed and placed in the "step_candidates" list.</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    All candidates are sorted in descending order of probabilities and the most probable ones</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    are selected from them, the number of which is set by the "beam_width" parameter.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">    """</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">candidate_step</span><span class="p">(</span><span class="n">chain</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">tgt_attn_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tgt_pad_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">src_pad_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="n">probabilities</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">step_mask</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="n">values</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">probabilities</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">beam_width</span><span class="p">,</span> <span class="n">step_width</span><span class="p">))</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="k">for</span> <span class="n">prob</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="n">new_token</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">token_size</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="n">new_token</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="n">step_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">chain</span><span class="p">,</span> <span class="n">new_token</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">score</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">)))</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>    <span class="n">step_candidates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="k">for</span> <span class="n">candidate_chain</span><span class="p">,</span> <span class="n">candidate_score</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="k">await</span> <span class="n">candidate_step</span><span class="p">(</span><span class="n">candidate_chain</span><span class="p">,</span> <span class="n">candidate_score</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">step_candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">candidate</span><span class="p">:</span> <span class="o">-</span><span class="n">candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">])[:</span><span class="n">beam_width</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.api_interactive_loop">
api_interactive_loop


</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">api_interactive_loop</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Get an asynchronous beam search algorithm loop function, which is implemented for the API interface.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>queue</code></td>
<td>
<code>asyncio.<span title="asyncio.Queue">Queue</span></code>
</td>
<td><p>Asynchronous queue for storing intermediate results.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>delimiter</code></td>
<td>
<code>str</code>
</td>
<td><p>Delimiter for columns visualization.</p></td>
<td>
<code>''</code>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>async_inner_loop</code></td> <td>
<code><span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>, <span title="torch.Tensor">Tensor</span>, <span title="trecover.model.TRecover">TRecover</span>, int, torch.<span title="torch.device">device</span>], <span title="typing.Awaitable">Awaitable</span>]</code>
</td>
<td><p>Asynchronous beam search algorithm loop function for the API interface.</p></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="k">def</span> <span class="nf">api_interactive_loop</span><span class="p">(</span><span class="n">queue</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">,</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                         <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">''</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">TRecover</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">],</span> <span class="n">Awaitable</span><span class="p">]:</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">    Get an asynchronous beam search algorithm loop function, which is implemented for the API interface.</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">    queue : asyncio.Queue</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">        Asynchronous queue for storing intermediate results.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">    delimiter: str, default=''</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">        Delimiter for columns visualization.</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    -------</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">    async_inner_loop : Callable[[Tensor, Tensor, TRecover, int, torch.device], Awaitable]</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        Asynchronous beam search algorithm loop function for the API interface.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    """</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_inner_loop</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                               <span class="n">encoded_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                               <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                               <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                               <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                               <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="w">        </span><span class="sd">"""</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">        Asynchronous beam search algorithm loop implementation for the API interface.</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">        src : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">            Keyless reading columns that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">        encoded_src : Tensor[SEQUENCE_LEN, 1, D_MODEL]</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">            Keyless reading columns that were encoded by TRecover encoder.</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">        model : TRecover</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">            Trained model for keyless reading.</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">        width : int</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">            Number of candidates that can be selected at each step.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">        device : torch.device</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">            Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        -----</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">        Probability masks and beam widths values required for each step of the</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">        beam search algorithm are calculated by the "get_steps_params" function using</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        keyless reading columns ("src") that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">        An empty chain (zero token of shape [1, 1, TOKEN_SIZE]) with zero probability</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">        is used as the first candidate for the algorithm.</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">        At each step of the algorithm, the intermediate results are placed in an asynchronous queue.</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">        At the end of the algorithm, a None value is placed in the asynchronous queue,</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        which is an indicator of its completion.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        """</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="n">step_masks</span><span class="p">,</span> <span class="n">step_widths</span> <span class="o">=</span> <span class="n">get_steps_params</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">token_size</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">encoded_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="n">candidates</span> <span class="o">=</span> <span class="k">await</span> <span class="n">async_beam_step</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">step_masks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>                                               <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>            <span class="n">intermediate_result</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                <span class="p">(</span><span class="n">tensor_to_target</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">score</span><span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>                <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">candidates</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>            <span class="p">]</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">([(</span><span class="n">visualize_target</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">),</span> <span class="n">score</span><span class="p">)</span> <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">intermediate_result</span><span class="p">])</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="k">return</span> <span class="n">async_inner_loop</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.standard_async_loop">
standard_async_loop

  <span class="doc doc-properties">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">standard_async_loop</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Base asynchronous implementation of the beam search algorithm loop.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, TOKEN_SIZE]</code>
</td>
<td><p>Keyless reading columns that are passed to the TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>encoded_src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, 1, D_MODEL]</code>
</td>
<td><p>Keyless reading columns that were encoded by TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>model</code></td>
<td>
<code><span title="trecover.model.TRecover">TRecover</span></code>
</td>
<td><p>Trained model for keyless reading.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>width</code></td>
<td>
<code>int</code>
</td>
<td><p>Number of candidates that can be selected at each step.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>device</code></td>
<td>
<code>torch.<span title="torch.device">device</span></code>
</td>
<td><p>Device on which to allocate the candidate chains.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>candidates</code></td> <td>
<code>List[Tuple[Tensor[1, SEQUENCE_LEN </code>
</td>
<td><p>List of chains sorted in descending order of probabilities.
The number of candidates is set by the "width" parameter.</p></td>
</tr>
</tbody>
</table>
<h4 id="src.trecover.utils.beam_search.standard_async_loop--notes">Notes</h4>
<p>Probability masks and beam widths values required for each step of the
beam search algorithm are calculated by the "get_steps_params" function using
keyless reading columns ("src") that are passed to the TRecover encoder.</p>
<p>An empty chain (zero token of shape [1, 1, TOKEN_SIZE]) with zero probability
is used as the first candidate for the algorithm.</p>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">standard_async_loop</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                              <span class="n">encoded_src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                              <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                              <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>                              <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                              <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">    Base asynchronous implementation of the beam search algorithm loop.</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    src : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">        Keyless reading columns that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    encoded_src : Tensor[SEQUENCE_LEN, 1, D_MODEL]</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">        Keyless reading columns that were encoded by TRecover encoder.</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    model : TRecover</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">        Trained model for keyless reading.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    width : int</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">        Number of candidates that can be selected at each step.</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">    device : torch.device</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">        Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    -------</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">    candidates : List[Tuple[Tensor[1, SEQUENCE_LEN + 1, TOKEN_SIZE], float]]</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">        List of chains sorted in descending order of probabilities.</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">        The number of candidates is set by the "width" parameter.</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">    -----</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="sd">    Probability masks and beam widths values required for each step of the</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">    beam search algorithm are calculated by the "get_steps_params" function using</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">    keyless reading columns ("src") that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">    An empty chain (zero token of shape [1, 1, TOKEN_SIZE]) with zero probability</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">    is used as the first candidate for the algorithm.</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">    """</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="n">step_masks</span><span class="p">,</span> <span class="n">step_widths</span> <span class="o">=</span> <span class="n">get_steps_params</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">token_size</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">encoded_src</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="n">candidates</span> <span class="o">=</span> <span class="k">await</span> <span class="n">async_beam_step</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">step_masks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                                           <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="src.trecover.utils.beam_search.async_beam_search">
async_beam_search

  <span class="doc doc-properties">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">async_beam_search</span><span class="p">(</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="n">src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">beam_loop</span><span class="o">=</span><span class="n">standard_async_loop</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Asynchronous beam search algorithm implementation.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>src</code></td>
<td>
<code><span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN, TOKEN_SIZE]</code>
</td>
<td><p>Keyless reading columns that are passed to the TRecover encoder.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>model</code></td>
<td>
<code><span title="trecover.model.TRecover">TRecover</span></code>
</td>
<td><p>Trained model for keyless reading.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>width</code></td>
<td>
<code>int</code>
</td>
<td><p>Number of candidates that can be selected at each step.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>device</code></td>
<td>
<code>torch.<span title="torch.device">device</span></code>
</td>
<td><p>Device on which to allocate the candidate chains.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>beam_loop</code></td>
<td>
<code>Callable[[Tensor, Tensor, TRecover, int, torch.device],</code>
</td>
<td><p>List[Tuple[Tensor, float]]], default=standard_loop
Beam search algorithm loop function.</p></td>
<td>
<code>standard_async_loop</code>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>candidates</code></td> <td>
<code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="torch.Tensor">Tensor</span>[SEQUENCE_LEN], float]]]</code>
</td>
<td><p>List of chains sorted in descending order of probabilities.
The number of candidates is set by the "width" parameter.
Returns None if "api_interactive_loop" is used as a beam search loop function.</p></td>
</tr>
</tbody>
</table>
<h4 id="src.trecover.utils.beam_search.async_beam_search--notes">Notes</h4>
<p>Initially, the keyless reading columns ("src") are encoded using TRecover encoder,
then the encoded columns ("encoded_src") are used at each step of the asynchronous algorithm.</p>
<details class="quote">
<summary>Source code in <code>src/trecover/utils/beam_search.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">async_beam_search</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                            <span class="n">model</span><span class="p">:</span> <span class="n">TRecover</span><span class="p">,</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                            <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                            <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>                            <span class="n">beam_loop</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">TRecover</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">],</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                                                <span class="n">Awaitable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]]]</span> <span class="o">=</span> <span class="n">standard_async_loop</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">    Asynchronous beam search algorithm implementation.</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">    src : Tensor[SEQUENCE_LEN, TOKEN_SIZE]</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">        Keyless reading columns that are passed to the TRecover encoder.</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a><span class="sd">    model : TRecover</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">        Trained model for keyless reading.</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">    width : int</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">        Number of candidates that can be selected at each step.</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="sd">    device : torch.device</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">        Device on which to allocate the candidate chains.</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">    beam_loop : Callable[[Tensor, Tensor, TRecover, int, torch.device],</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">                        List[Tuple[Tensor, float]]], default=standard_loop</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">        Beam search algorithm loop function.</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    -------</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    candidates : Optional[List[Tuple[Tensor[SEQUENCE_LEN], float]]]</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        List of chains sorted in descending order of probabilities.</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">        The number of candidates is set by the "width" parameter.</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">        Returns None if "api_interactive_loop" is used as a beam search loop function.</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">    -----</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">    Initially, the keyless reading columns ("src") are encoded using TRecover encoder,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">    then the encoded columns ("encoded_src") are used at each step of the asynchronous algorithm.</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">    """</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="n">encoded_src</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">src_pad_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="n">candidates</span> <span class="o">=</span> <span class="k">await</span> <span class="n">beam_loop</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">encoded_src</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="k">return</span> <span class="p">[(</span><span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">score</span><span class="p">)</span> <span class="k">for</span> <span class="n">chain</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">]</span> <span class="k">if</span> <span class="n">candidates</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
</article>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" hidden="" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Celery Tasks" class="md-footer__link md-footer__link--prev" href="../../app/api/backend/tasks/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Celery Tasks
            </div>
</div>
</a>
<a aria-label="Next: CLI" class="md-footer__link md-footer__link--next" href="../cli/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              CLI
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright  2022
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://www.linkedin.com/in/alex-snd" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
<a class="md-social__link" href="https://t.me/alexsnd" rel="noopener" target="_blank" title="t.me">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"></path></svg>
</a>
<a class="md-social__link" href="mailto:alexandershulga.sh@gmail.com" rel="noopener" target="_blank" title="">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49v-.663c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2 0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.16-16.02-16.01-16.02l-31.98.003c-7.299 0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44 0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2v-20.9c0-149.2-133.9-265.632-287.3-235.57zm31.3 283.57c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/alex-snd" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://hub.docker.com/u/alexsnd0" rel="noopener" target="_blank" title="hub.docker.com">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.expand", "navigation.indexes", "toc.follow", "navigation.instant", "navigation.tracking", "content.tabs.link", "navigation.top"], "search": "../../../../assets/javascripts/workers/search.b028fd86.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../../../../assets/javascripts/bundle.f758a944.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="../../../../static/js/termynal.js"></script>
<script src="../../../../static/js/custom.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body>
</html>